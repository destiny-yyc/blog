

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/maple_leaf.png">
  <link rel="icon" href="/blog/img/maple_leaf.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="æ«ğŸå·">
  <meta name="keywords" content="">
  
    <meta name="description" content="æ£€éªŒä¸€ä¸‹ä½ æ˜¯çœŸçš„å®Œå…¨æŒæ¡äº†Promiseï¼Ÿ ç›¸ä¿¡å¤§å®¶å¯¹**Promiseéƒ½ååˆ†ç†Ÿæ‚‰äº†å§ï¼Œä½†ä½ ä»¬æƒ³æƒ³ï¼Œæ˜¯ä¸æ˜¯å°±é‚£ä¹ˆå‡ ä¸ªapiï¼Œå¯æ˜¯ä½ çœŸçš„äº†è§£Promise**å—ï¼Ÿ  æœ¬æ–‡å°±å¸¦å¤§å®¶å½»åº•ç›˜ç‚¹Promise ~ Promise ç®€ä»‹Promise æ˜¯ä¸€ç§å¤„ç†å¼‚æ­¥ä»£ç è€Œä¸ä¼šé™·å…¥å›è°ƒåœ°ç‹±çš„æ–¹å¼ã€‚ å¤šå¹´æ¥ï¼ŒPromise å·²æˆä¸ºè¯­è¨€çš„ä¸€éƒ¨åˆ†(åœ¨ES2015ä¸­è¿›è¡Œäº†æ ‡å‡†åŒ–å’Œå¼•å…¥)ï¼Œå¹¶ä¸”æœ€è¿‘å˜åŒ–æ›´åŠ é›†æˆï¼Œåœ¨ES20">
<meta property="og:type" content="article">
<meta property="og:title" content="Promise çŸ¥è¯†ç‚¹æ€»ç»“">
<meta property="og:url" content="https://destiny-yyc.github.io/promisre-summarize.html">
<meta property="og:site_name" content="æ«ğŸå·çš„åšå®¢">
<meta property="og:description" content="æ£€éªŒä¸€ä¸‹ä½ æ˜¯çœŸçš„å®Œå…¨æŒæ¡äº†Promiseï¼Ÿ ç›¸ä¿¡å¤§å®¶å¯¹**Promiseéƒ½ååˆ†ç†Ÿæ‚‰äº†å§ï¼Œä½†ä½ ä»¬æƒ³æƒ³ï¼Œæ˜¯ä¸æ˜¯å°±é‚£ä¹ˆå‡ ä¸ªapiï¼Œå¯æ˜¯ä½ çœŸçš„äº†è§£Promise**å—ï¼Ÿ  æœ¬æ–‡å°±å¸¦å¤§å®¶å½»åº•ç›˜ç‚¹Promise ~ Promise ç®€ä»‹Promise æ˜¯ä¸€ç§å¤„ç†å¼‚æ­¥ä»£ç è€Œä¸ä¼šé™·å…¥å›è°ƒåœ°ç‹±çš„æ–¹å¼ã€‚ å¤šå¹´æ¥ï¼ŒPromise å·²æˆä¸ºè¯­è¨€çš„ä¸€éƒ¨åˆ†(åœ¨ES2015ä¸­è¿›è¡Œäº†æ ‡å‡†åŒ–å’Œå¼•å…¥)ï¼Œå¹¶ä¸”æœ€è¿‘å˜åŒ–æ›´åŠ é›†æˆï¼Œåœ¨ES20">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/22/ppdtuy8.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/23/ppwiAfI.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/23/ppwkiRI.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/23/ppwM0Et.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/23/ppwMD4f.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/23/ppwM55V.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/23/ppwQp8O.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/23/ppwQiKH.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/23/ppwQuRS.png">
<meta property="article:published_time" content="2022-06-11T16:00:00.000Z">
<meta property="article:modified_time" content="2023-03-24T08:06:19.007Z">
<meta property="article:author" content="æ«ğŸå·">
<meta property="article:tag" content="promise">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s1.ax1x.com/2023/03/22/ppdtuy8.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Promise çŸ¥è¯†ç‚¹æ€»ç»“ - æ«ğŸå·çš„åšå®¢</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/blog/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/blog/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/blog/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"destiny-yyc.github.io","root":"/blog/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/blog/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/blog/">
      <strong>æ«ğŸå·çš„åšå®¢</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/blog/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Promise çŸ¥è¯†ç‚¹æ€»ç»“"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        æ«ğŸå·
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-06-12 00:00" pubdate>
          2022å¹´6æœˆ12æ—¥
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          19k å­—
        
      </span>
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Promise çŸ¥è¯†ç‚¹æ€»ç»“</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="æ£€éªŒä¸€ä¸‹ä½ æ˜¯çœŸçš„å®Œå…¨æŒæ¡äº†Promiseï¼Ÿ"><a href="#æ£€éªŒä¸€ä¸‹ä½ æ˜¯çœŸçš„å®Œå…¨æŒæ¡äº†Promiseï¼Ÿ" class="headerlink" title="æ£€éªŒä¸€ä¸‹ä½ æ˜¯çœŸçš„å®Œå…¨æŒæ¡äº†Promiseï¼Ÿ"></a>æ£€éªŒä¸€ä¸‹ä½ æ˜¯çœŸçš„å®Œå…¨æŒæ¡äº†Promiseï¼Ÿ</h1><blockquote>
<p>ç›¸ä¿¡å¤§å®¶å¯¹**<code>Promise</code><strong>éƒ½ååˆ†ç†Ÿæ‚‰äº†å§ï¼Œä½†ä½ ä»¬æƒ³æƒ³ï¼Œæ˜¯ä¸æ˜¯å°±é‚£ä¹ˆå‡ ä¸ªapiï¼Œå¯æ˜¯ä½ çœŸçš„äº†è§£</strong><code>Promise</code>**å—ï¼Ÿ</p>
</blockquote>
<p>æœ¬æ–‡å°±å¸¦å¤§å®¶å½»åº•ç›˜ç‚¹Promise ~</p>
<h1 id="Promise-ç®€ä»‹"><a href="#Promise-ç®€ä»‹" class="headerlink" title="Promise ç®€ä»‹"></a>Promise ç®€ä»‹</h1><p>Promise æ˜¯ä¸€ç§å¤„ç†å¼‚æ­¥ä»£ç <code>è€Œä¸ä¼šé™·å…¥å›è°ƒåœ°ç‹±</code>çš„æ–¹å¼ã€‚</p>
<p>å¤šå¹´æ¥ï¼ŒPromise å·²æˆä¸ºè¯­è¨€çš„ä¸€éƒ¨åˆ†(åœ¨ES2015ä¸­è¿›è¡Œäº†æ ‡å‡†åŒ–å’Œå¼•å…¥)ï¼Œå¹¶ä¸”æœ€è¿‘å˜åŒ–æ›´åŠ é›†æˆï¼Œåœ¨ES2017ä¸­å…·æœ‰asyncå’Œawaitã€‚</p>
<p><strong>å¼‚æ­¥å‡½æ•°</strong>åœ¨åº•å±‚ä½¿ç”¨äº†Promiseï¼Œå› æ­¤äº†è§£Promiseçš„å·¥ä½œæ–¹å¼æ˜¯äº†è§£ <strong>async</strong> å’Œ <strong>await</strong> çš„åŸºç¡€ã€‚</p>
<p><code>Promise</code>å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ã€<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰å’Œ<code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰</p>
<p>ä¸€ä¸ª <code>Promise</code> å¿…ç„¶å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ï¼š</p>
<ul>
<li>å¾…å®š <code>(pending)</code>: åˆå§‹çŠ¶æ€ï¼Œæ—¢æ²¡æœ‰è¢«å…‘ç°ï¼Œä¹Ÿæ²¡æœ‰è¢«æ‹’ç»ã€‚</li>
<li>å·²æˆåŠŸ <code>(fulfilled)</code>: æ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆã€‚</li>
<li>å·²æ‹’ç» <code>(rejected)</code>: æ„å‘³ç€æ“ä½œå¤±è´¥ã€‚</li>
</ul>
<h1 id="Promise-å¦‚ä½•è¿ä½œ"><a href="#Promise-å¦‚ä½•è¿ä½œ" class="headerlink" title="Promise å¦‚ä½•è¿ä½œ"></a>Promise å¦‚ä½•è¿ä½œ</h1><p>å½“ promise è¢«è°ƒç”¨åï¼Œå®ƒä¼šä»¥<strong>å¤„ç†ä¸­çŠ¶æ€</strong> <code>(pending)</code> å¼€å§‹ã€‚ è¿™æ„å‘³ç€è°ƒç”¨çš„å‡½æ•°ä¼šç»§ç»­æ‰§è¡Œï¼Œè€Œ promise ä»å¤„äºå¤„ç†ä¸­ç›´åˆ°è§£å†³ä¸ºæ­¢ï¼Œä»è€Œä¸ºè°ƒç”¨çš„å‡½æ•°æä¾›æ‰€è¯·æ±‚çš„ä»»ä½•æ•°æ®ã€‚</p>
<p>è¢«åˆ›å»ºçš„ promise æœ€ç»ˆä¼šä»¥<strong>è¢«è§£å†³çŠ¶æ€</strong> <code>(fulfilled)</code> æˆ– <strong>è¢«æ‹’ç»çŠ¶æ€</strong> <code>(rejected)</code> ç»“æŸï¼Œå¹¶åœ¨å®Œæˆæ—¶è°ƒç”¨ç›¸åº”çš„å›è°ƒå‡½æ•°ï¼ˆä¼ ç»™ <strong>then</strong> å’Œ <strong>catch</strong>ï¼‰ã€‚</p>
<p>â—¾ ä¸ºäº†è®©è¯»è€…å°½å¿«å¯¹promiseæœ‰ä¸€ä¸ªæ•´ä½“çš„ç†è§£ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µpromiseçš„ä»£ç ï¼š</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
    <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;æˆåŠŸ&#x27;</span>) <span class="hljs-comment">// åªä¼šè¿”å›ç¬¬ä¸€æ¬¡çš„çŠ¶æ€</span>
    <span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;å¤±è´¥&#x27;</span>)
&#125;)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;p1&#x27;</span>, p1)

<span class="hljs-keyword">let</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
    <span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;å¤±è´¥&#x27;</span>)
    <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;æˆåŠŸ&#x27;</span>)
&#125;)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;p2&#x27;</span>, p2)

<span class="hljs-keyword">let</span> p3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">throw</span>(<span class="hljs-string">&#x27;æŠ¥é”™&#x27;</span>)
&#125;)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;p3&#x27;</span>, p3)</code></pre></div>

<p>è¾“å‡ºç»“æœï¼š</p>
<p><img src="https://s1.ax1x.com/2023/03/22/ppdtuy8.png" srcset="/blog/img/loading.gif" lazyload></p>
<p><strong>è¿™é‡ŒåŒ…å«äº†å››ä¸ªçŸ¥è¯†ç‚¹ï¼š</strong></p>
<ol>
<li>æ‰§è¡Œäº†<code>resolve</code>ï¼ŒPromiseçŠ¶æ€ä¼šå˜æˆ<code>fulfilled</code>ï¼Œå³<strong>å·²å®ŒæˆçŠ¶æ€</strong>ã€‚</li>
<li>æ‰§è¡Œäº†<code>reject</code>ï¼ŒPromiseçŠ¶æ€ä¼šå˜æˆ<code>rejected</code>ï¼Œå³<strong>è¢«æ‹’ç»çŠ¶æ€</strong>ã€‚</li>
<li>Promiseåªä»¥<code>ç¬¬ä¸€æ¬¡ä¸ºå‡†</code>ï¼Œç¬¬ä¸€æ¬¡æˆåŠŸå°±<code>æ°¸ä¹…ä¸ºfulfilled</code>ï¼Œç¬¬ä¸€æ¬¡å¤±è´¥å°±ä¸º<code>rejected</code>ã€‚</li>
<li>Promiseä¸­æœ‰<code>throw</code>çš„è¯ï¼Œå°±ç›¸å½“äºæ‰§è¡Œäº†<code>reject</code>ã€‚</li>
</ol>
<p>â—¾ æ¥ä¸‹æ¥çœ‹ä¸‹é¢ä¸€æ®µä»£ç ï¼Œå­¦ä¹ æ–°çš„çŸ¥è¯†ç‚¹ï¼š</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> myPromise1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">() =&gt;</span> &#123;&#125;);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;myPromise1 :&gt;&gt; &#x27;</span>, myPromise1);

<span class="hljs-keyword">let</span> myPromise2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">5</span>; index++) &#123;
        a++;
    &#125;
&#125;)

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;myPromise2 :&gt;&gt; &#x27;</span>, myPromise2)

myPromise2.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;myPromise2æ‰§è¡Œäº†then&quot;</span>);
&#125;)</code></pre></div>

<p>è¾“å‡ºç»“æœï¼š</p>
<p><img src="https://s1.ax1x.com/2023/03/23/ppwiAfI.png" srcset="/blog/img/loading.gif" lazyload></p>
<p><strong>è¿™é‡ŒåŒ…å«äº†ä¸‰ä¸ªçŸ¥è¯†ç‚¹ï¼š</strong></p>
<ol>
<li>Promiseçš„åˆå§‹åŒ–çŠ¶æ€æ˜¯<code>pending</code>ã€‚</li>
<li>Promiseé‡Œæ²¡æœ‰æ‰§è¡Œ<code>resolve</code>ã€<code>reject</code>ä»¥åŠ<code>throw</code>çš„è¯ï¼Œè¿™ä¸ª**Promiseçš„çŠ¶æ€ä¹Ÿæ˜¯<code>pending</code>**ã€‚</li>
<li>åŸºäºä¸Šä¸€æ¡ï¼Œ<code>pending</code>çŠ¶æ€ä¸‹çš„Promiseä¸ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°<code>then()</code>ã€‚</li>
</ol>
<p><strong>â—¾ æœ€åä¸€ç‚¹ï¼š</strong></p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> myPromise0 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;myPromise =&gt;&quot;</span>, myPromise0)</code></pre></div>

<p>è¾“å‡ºç»“æœï¼š</p>
<p><img src="https://s1.ax1x.com/2023/03/23/ppwkiRI.png" srcset="/blog/img/loading.gif" lazyload></p>
<p>è¿™ä¸ªé‡ŒåŒ…å«äº†ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li>è§„å®šå¿…é¡»ç»™<code>Promise</code>å¯¹è±¡ä¼ å…¥ä¸€ä¸ªæ‰§è¡Œå‡½æ•°ï¼Œå¦åˆ™å°†ä¼šæŠ¥é”™ã€‚</li>
</ul>
<p>ä¸åŒäºâ€œè€å¼â€çš„ä¼ å…¥å›è°ƒï¼Œåœ¨ä½¿ç”¨ Promise æ—¶ï¼Œä¼šæœ‰ä»¥ä¸‹çº¦å®šï¼š</p>
<ul>
<li>åœ¨æœ¬è½® <strong>äº‹ä»¶å¾ªç¯</strong> è¿è¡Œå®Œæˆä¹‹å‰ï¼Œå›è°ƒå‡½æ•°æ˜¯ä¸ä¼šè¢«è°ƒç”¨çš„ã€‚</li>
<li>å³ä½¿å¼‚æ­¥æ“ä½œå·²ç»å®Œæˆï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰ï¼Œåœ¨è¿™ä¹‹åé€šè¿‡ then() æ·»åŠ çš„å›è°ƒå‡½æ•°ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚</li>
<li>é€šè¿‡å¤šæ¬¡è°ƒç”¨ then() å¯ä»¥æ·»åŠ å¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå®ƒä»¬ä¼šæŒ‰ç…§æ’å…¥é¡ºåºè¿›è¡Œæ‰§è¡Œã€‚</li>
</ul>
<p>Promise å¾ˆæ£’çš„ä¸€ç‚¹å°±æ˜¯<strong>é“¾å¼è°ƒç”¨</strong>ã€‚ </p>
<h1 id="åˆ›å»ºPromise"><a href="#åˆ›å»ºPromise" class="headerlink" title="åˆ›å»ºPromise"></a>åˆ›å»ºPromise</h1><p>Promise API å…¬å¼€äº†è®´æ­ŒPromiseæ„é€ å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ <code>new Promise()</code> å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼š</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> done = <span class="hljs-literal">true</span>

<span class="hljs-keyword">const</span> isItDoneYet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
  <span class="hljs-keyword">if</span> (done) &#123;
    <span class="hljs-keyword">const</span> workDone = <span class="hljs-string">&#x27;è¿™æ˜¯åˆ›å»ºçš„ä¸œè¥¿&#x27;</span>
    <span class="hljs-title function_">resolve</span>(workDone)
  &#125; <span class="hljs-keyword">else</span> &#123;
    <span class="hljs-keyword">const</span> why = <span class="hljs-string">&#x27;ä»ç„¶åœ¨å¤„ç†å…¶ä»–äº‹æƒ…&#x27;</span>
    <span class="hljs-title function_">reject</span>(why)
  &#125;
&#125;)</code></pre></div>

<p>å¦‚ä½ æ‰€è§ï¼ŒPromise æ£€æŸ¥äº† done å…¨å±€å˜é‡ï¼Œå¦‚æœä¸º<strong>çœŸ</strong>ï¼Œåˆ™Promiseè¿›å…¥äº†<strong>è¢«è§£å†³</strong>çŠ¶æ€(å› ä¸ºè°ƒç”¨äº†<code>resolve</code>å›è°ƒ)ï¼›å¦åˆ™ï¼Œåˆ™æ‰§è¡Œ<code>reject</code>å›è°ƒ(å°†Promiseç½®äº<strong>è¢«æ‹’ç»</strong>çŠ¶æ€)ã€‚å¦‚æœåœ¨æ‰§è¡Œè·¯å¾„ä¸­ä»æœªè°ƒç”¨è¿‡è¿™äº›å‡½æ•°ä¹‹ä¸€ï¼Œåˆ™Promiseä¼šä¿æŒå¤„ç†ä¸­çŠ¶æ€ã€‚</p>
<p>ä½¿ç”¨<code>resolve</code>å’Œ<code>reject</code>ï¼Œå¯ä»¥å‘è°ƒç”¨è€…ä¼ è¾¾æœ€ç»ˆçš„PromiseçŠ¶æ€ä»¥åŠè¯¥å¦‚ä½•å¤„ç†ã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œåªè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä¸º<code>null</code>ã€‚ç”±äºå·²ç»åœ¨ä¸Šè¿°çš„ä»£ç ç‰‡æ®µä¸­åˆ›å»ºäº†Promiseï¼Œå› æ­¤å®ƒå·²ç»å¼€å§‹æ‰§è¡Œã€‚</p>
<p>ä¸€ä¸ªæ›´å¸¸è§çš„ç¤ºä¾‹æ˜¯ä¸€ç§è¢«ç§°ä¸º promisifying çš„æŠ€æœ¯ã€‚è¿™é¡¹æŠ€æœ¯èƒ½å¤Ÿä½¿ç”¨ç»å…¸çš„ JavaScript çš„å‡½æ•°æ¥æ¥å—å›è°ƒå¹¶ä½¿å…¶è¿”å›Promiseï¼š</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getFile</span> = (<span class="hljs-params">fileName</span>) =&gt; &#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
    fs.<span class="hljs-title function_">readFile</span>(fileName, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;
      <span class="hljs-keyword">if</span> (err) &#123;
        <span class="hljs-title function_">reject</span>(err)  <span class="hljs-comment">// è°ƒç”¨ `reject` ä¼šå¯¼è‡´ promise å¤±è´¥ï¼Œæ— è®ºæ˜¯å¦ä¼ å…¥é”™è¯¯ä½œä¸ºå‚æ•°ï¼Œ</span>
        <span class="hljs-keyword">return</span>        <span class="hljs-comment">// ä¸”ä¸å†è¿›è¡Œä¸‹å»ã€‚</span>
      &#125;
      <span class="hljs-title function_">resolve</span>(data)
    &#125;)
  &#125;)
&#125;

<span class="hljs-title function_">getFile</span>(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>)
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data))
.<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err))</code></pre></div>

<h1 id="ä½¿ç”¨Promise"><a href="#ä½¿ç”¨Promise" class="headerlink" title="ä½¿ç”¨Promise"></a>ä½¿ç”¨Promise</h1><p>ç°åœ¨ï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ promiseã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> isItDoneYet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-comment">/* ... å¦‚ä¸Šæ‰€è¿° ... */</span>)
<span class="hljs-comment">//...</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkIfItsDone</span> = (<span class="hljs-params"></span>) =&gt; &#123;
  isItDoneYet
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">ok</span> =&gt;</span> &#123;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ok)
    &#125;)
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err)
    &#125;)</code></pre></div>

<p>è¿è¡Œ <code>checkIfItsDone()</code> ä¼šæŒ‡å®šå½“ <code>isItDoneYet</code>  promise è¢«è§£å†³ï¼ˆåœ¨ <strong>then</strong> è°ƒç”¨ä¸­ï¼‰æˆ–è¢«æ‹’ç»ï¼ˆåœ¨ <strong>catch</strong> è°ƒç”¨ä¸­ï¼‰æ—¶æ‰§è¡Œçš„å‡½æ•°ã€‚</p>
<h1 id="å®ä¾‹-promise-å°è£…-AJAX"><a href="#å®ä¾‹-promise-å°è£…-AJAX" class="headerlink" title="å®ä¾‹ promise å°è£… AJAX"></a>å®ä¾‹ promise å°è£… AJAX</h1><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// Promiseå°è£…Ajaxè¯·æ±‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ajax</span>(<span class="hljs-params">method, url, data</span>) &#123;
    <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) &#123;
        xhr.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;
            <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">readyState</span> !== <span class="hljs-number">4</span>) <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;
                <span class="hljs-title function_">resolve</span>(xhr.<span class="hljs-property">responseText</span>);
            &#125; <span class="hljs-keyword">else</span> &#123;
                <span class="hljs-title function_">reject</span>(xhr.<span class="hljs-property">statusText</span>);
            &#125;

        &#125;;
        xhr.<span class="hljs-title function_">open</span>(method, url);
        xhr.<span class="hljs-title function_">send</span>(data);
    &#125;);
&#125;</code></pre></div>

<p>ä½¿ç”¨ä¸Šé¢å°è£…å¥½çš„ajaxå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼š</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">ajax</span>(<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;/api/categories&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) &#123;
    <span class="hljs-comment">// AJAXæˆåŠŸï¼Œæ‹¿åˆ°å“åº”æ•°æ®</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">status</span>) &#123;
    <span class="hljs-comment">// AJAXå¤±è´¥ï¼Œæ ¹æ®å“åº”ç åˆ¤æ–­å¤±è´¥åŸå› </span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(status)
&#125;);</code></pre></div>

<h1 id="Promise-resolve"><a href="#Promise-resolve" class="headerlink" title="Promise.resolve()"></a>Promise.resolve()</h1><p>æœ‰æ—¶éœ€è¦å°†ç°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ï¼Œ<code>Promise.resolve()</code>æ–¹æ³•å°±èµ·åˆ°è¿™ä¸ªä½œç”¨ã€‚</p>
<blockquote>
<p>æ³¨æ„ â— â— â— è¿™é‡Œçš„<code>Promise.resolve()</code>æ˜¯ç›´æ¥ä½¿ç”¨çš„ï¼Œä¸æ˜¯åœ¨promiseå¯¹è±¡é‡Œçš„<code>resolve()</code>æ–¹æ³•ï¼Œæ˜¯<code>Promise.resolve()</code> ï¼Œå¼€å¤´å¤§å†™ï¼Œä¸æ˜¯<code>promise</code></p>
</blockquote>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> jsPromise = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>($.<span class="hljs-title function_">ajax</span>(<span class="hljs-string">&#x27;/whatever.json&#x27;</span>));</code></pre></div>

<p>ä¸Šé¢ä»£ç å°† jQuery ç”Ÿæˆçš„å¯¹è±¡ï¼Œè½¬ä¸ºä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ã€‚</p>
<p><code>Promise.resolve()</code>ç­‰ä»·äºä¸‹é¢çš„å†™æ³•ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;foo&#x27;</span>)
<span class="hljs-comment">// ç­‰ä»·äº</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;foo&#x27;</span>))</code></pre></div>

<p><code>Promise.resolve</code>æ–¹æ³•çš„å‚æ•°åˆ†æˆå››ç§æƒ…å†µã€‚</p>
<p>â—¾ <strong>ï¼ˆ1ï¼‰å‚æ•°æ˜¯ä¸€ä¸ª Promise å®ä¾‹</strong></p>
<p>å¦‚æœå‚æ•°æ˜¯ Promise å®ä¾‹ï¼Œé‚£ä¹ˆPromise.resolveå°†ä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå®ä¾‹ã€‚</p>
<p>â—¾ <strong>ï¼ˆ2ï¼‰å‚æ•°æ˜¯ä¸€ä¸ªthenableå¯¹è±¡</strong></p>
<p><code>thenable</code>å¯¹è±¡æŒ‡çš„æ˜¯å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå¯¹è±¡ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> thenable = &#123;
  <span class="hljs-attr">then</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) &#123;
    <span class="hljs-title function_">resolve</span>(<span class="hljs-number">42</span>);
  &#125;
&#125;;</code></pre></div>

<p><code>Promise.resolve</code>æ–¹æ³•ä¼šå°†è¿™ä¸ªå¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ï¼Œç„¶åå°±ç«‹å³æ‰§è¡Œ<code>thenable</code>å¯¹è±¡çš„<code>then</code>æ–¹æ³•ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> thenable = &#123;
  <span class="hljs-attr">then</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) &#123;
    <span class="hljs-title function_">resolve</span>(<span class="hljs-number">42</span>);
  &#125;
&#125;;
<span class="hljs-keyword">let</span> p1 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(thenable);
p1.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);  <span class="hljs-comment">// 42</span>
&#125;);</code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>thenable</code>å¯¹è±¡çš„<code>then</code>æ–¹æ³•æ‰§è¡Œåï¼Œå¯¹è±¡<code>p1</code>çš„çŠ¶æ€å°±å˜ä¸º<code>resolved</code>ï¼Œä»è€Œç«‹å³æ‰§è¡Œæœ€åé‚£ä¸ª<code>then</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œè¾“å‡º 42ã€‚</p>
<p>â—¾ <strong>ï¼ˆ3ï¼‰å‚æ•°ä¸æ˜¯å…·æœ‰thenæ–¹æ³•çš„å¯¹è±¡ï¼Œæˆ–æ ¹æœ¬å°±ä¸æ˜¯å¯¹è±¡</strong></p>
<p>å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªä¸å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œåˆ™<code>Promise.resolve</code>æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ <code>Promise</code> å¯¹è±¡ï¼ŒçŠ¶æ€ä¸º<code>resolved</code>ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> p = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>);
p.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">s</span>)&#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(s)
&#125;);
<span class="hljs-comment">// Hello</span></code></pre></div>

<p>ä¸Šé¢ä»£ç ç”Ÿæˆä¸€ä¸ªæ–°çš„ <code>Promise</code> å¯¹è±¡çš„å®ä¾‹<code>p</code>ã€‚ç”±äºå­—ç¬¦ä¸²<code>Hello</code>ä¸å±äºå¼‚æ­¥æ“ä½œï¼ˆåˆ¤æ–­æ–¹æ³•æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ä¸å…·æœ‰ <code>then</code> æ–¹æ³•ï¼‰ï¼Œè¿”å› <code>Promise</code> å®ä¾‹çš„çŠ¶æ€ä»ä¸€ç”Ÿæˆå°±æ˜¯<code>resolved</code>ï¼Œæ‰€ä»¥å›è°ƒå‡½æ•°ä¼šç«‹å³æ‰§è¡Œã€‚<code>Promise.resolve</code>æ–¹æ³•çš„å‚æ•°ï¼Œä¼šåŒæ—¶ä¼ ç»™å›è°ƒå‡½æ•°ã€‚</p>
<p>â—¾ <strong>ï¼ˆ4ï¼‰ä¸å¸¦æœ‰ä»»ä½•å‚æ•°</strong></p>
<p><code>Promise.resolve()</code>æ–¹æ³•å…è®¸è°ƒç”¨æ—¶ä¸å¸¦å‚æ•°ï¼Œç›´æ¥è¿”å›ä¸€ä¸ª<code>resolved</code>çŠ¶æ€çš„ Promise å¯¹è±¡ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœå¸Œæœ›å¾—åˆ°ä¸€ä¸ª Promise å¯¹è±¡ï¼Œæ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•å°±æ˜¯ç›´æ¥è°ƒç”¨<code>Promise.resolve()</code>æ–¹æ³•ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> p = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>();
p.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;
  <span class="hljs-comment">// ...</span>
&#125;);</code></pre></div>

<p>ä¸Šé¢ä»£ç çš„å˜é‡på°±æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç«‹å³<code>resolve()</code>çš„ Promise å¯¹è±¡ï¼Œæ˜¯åœ¨æœ¬è½®â€œäº‹ä»¶å¾ªç¯â€ï¼ˆevent loopï¼‰çš„ç»“æŸæ—¶æ‰§è¡Œï¼Œè€Œä¸æ˜¯åœ¨ä¸‹ä¸€è½®â€œäº‹ä»¶å¾ªç¯â€çš„å¼€å§‹æ—¶ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;three&#x27;</span>);
&#125;, <span class="hljs-number">0</span>);
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;two&#x27;</span>);
&#125;);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;one&#x27;</span>);
<span class="hljs-comment">// one</span>
<span class="hljs-comment">// two</span>
<span class="hljs-comment">// three</span></code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>setTimeout(fn, 0)</code>åœ¨ä¸‹ä¸€è½®â€œäº‹ä»¶å¾ªç¯â€å¼€å§‹æ—¶æ‰§è¡Œï¼Œ<code>Promise.resolve()</code>åœ¨æœ¬è½®â€œäº‹ä»¶å¾ªç¯â€ç»“æŸæ—¶æ‰§è¡Œï¼Œ<code>console.log(&#39;one&#39;)</code>åˆ™æ˜¯ç«‹å³æ‰§è¡Œï¼Œå› æ­¤æœ€å…ˆè¾“å‡ºã€‚</p>
<h1 id="Promise-reject"><a href="#Promise-reject" class="headerlink" title="Promise.reject()"></a>Promise.reject()</h1><p><code>Promise.reject(reason)</code>æ–¹æ³•ä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼Œè¯¥å®ä¾‹çš„çŠ¶æ€ä¸º<code>rejected</code>ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> p = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;å‡ºé”™äº†&#x27;</span>);
<span class="hljs-comment">// ç­‰åŒäº</span>
<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;å‡ºé”™äº†&#x27;</span>))
p.<span class="hljs-title function_">then</span>(<span class="hljs-literal">null</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">s</span>) &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(s)
&#125;);
<span class="hljs-comment">// å‡ºé”™äº†</span></code></pre></div>

<p>ä¸Šé¢ä»£ç ç”Ÿæˆä¸€ä¸ª Promise å¯¹è±¡çš„å®ä¾‹<code>p</code>ï¼ŒçŠ¶æ€ä¸º<code>rejected</code>ï¼Œå›è°ƒå‡½æ•°ä¼šç«‹å³æ‰§è¡Œã€‚</p>
<p>æ³¨æ„ï¼Œ<code>Promise.reject()</code>æ–¹æ³•çš„å‚æ•°ï¼Œä¼šåŸå°ä¸åŠ¨åœ°ä½œä¸º<code>reject</code>çš„ç†ç”±ï¼Œå˜æˆåç»­æ–¹æ³•çš„å‚æ•°ã€‚è¿™ä¸€ç‚¹ä¸<code>Promise.resolve</code>æ–¹æ³•ä¸ä¸€è‡´ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> thenable = &#123;
  <span class="hljs-title function_">then</span>(<span class="hljs-params">resolve, reject</span>) &#123;
    <span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;å‡ºé”™äº†&#x27;</span>);
  &#125;
&#125;;
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(thenable)
.<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e === thenable)
&#125;)
<span class="hljs-comment">// true</span></code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>Promise.reject</code>æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ª<code>thenable</code>å¯¹è±¡ï¼Œæ‰§è¡Œä»¥åï¼Œåé¢<code>catch</code>æ–¹æ³•çš„å‚æ•°ä¸æ˜¯<code>reject</code>æŠ›å‡ºçš„â€œå‡ºé”™äº†â€è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯<code>thenable</code>å¯¹è±¡ã€‚</p>
<h1 id="Promise-prototype-then"><a href="#Promise-prototype-then" class="headerlink" title="Promise.prototype.then()"></a>Promise.prototype.then()</h1><p>Promise å®ä¾‹å…·æœ‰<code>then</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>then</code>æ–¹æ³•æ˜¯å®šä¹‰åœ¨åŸå‹å¯¹è±¡<code>Promise.prototype</code>ä¸Šçš„ã€‚å®ƒçš„ä½œç”¨æ˜¯ä¸º Promise å®ä¾‹æ·»åŠ çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°ã€‚</p>
<p><code>then</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>resolved</code>çŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚å¦‚æœè¯¥å‚æ•°ä¸æ˜¯å‡½æ•°ï¼Œåˆ™ä¼šåœ¨å†…éƒ¨è¢«æ›¿æ¢ä¸º <code>(x) =&gt; x</code>ï¼Œå³åŸæ ·è¿”å› promise æœ€ç»ˆç»“æœçš„å‡½æ•°ï¼›</p>
<p>ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯é€‰ï¼‰æ˜¯<code>rejected</code>çŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚å¦‚æœè¯¥å‚æ•°ä¸æ˜¯å‡½æ•°ï¼Œåˆ™ä¼šåœ¨å†…éƒ¨è¢«æ›¿æ¢ä¸ºä¸€ä¸ª â€œThrowerâ€ å‡½æ•° (it throws an error it received as argument)ã€‚</p>
<p><code>then</code>æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„<code>Promise</code>å®ä¾‹ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯åŸæ¥é‚£ä¸ª<code>Promise</code>å®ä¾‹ï¼‰ã€‚å› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ï¼Œå³<code>then</code>æ–¹æ³•åé¢å†è°ƒç”¨å¦ä¸€ä¸ª<code>then</code>æ–¹æ³•ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">getJSON</span>(<span class="hljs-string">&quot;/posts.json&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">json</span>) &#123;
  <span class="hljs-keyword">return</span> json.<span class="hljs-property">post</span>;
&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">post</span>) &#123;
  <span class="hljs-comment">// ...</span>
&#125;);</code></pre></div>

<p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨<code>then</code>æ–¹æ³•ï¼Œä¾æ¬¡æŒ‡å®šäº†ä¸¤ä¸ªå›è°ƒå‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å®Œæˆä»¥åï¼Œä¼šå°†è¿”å›ç»“æœä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ã€‚</p>
<p>é‡‡ç”¨é“¾å¼çš„<code>then</code>ï¼Œå¯ä»¥æŒ‡å®šä¸€ç»„æŒ‰ç…§æ¬¡åºè°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚è¿™æ—¶ï¼Œå‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæœ‰å¯èƒ½è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ï¼ˆå³æœ‰å¼‚æ­¥æ“ä½œï¼‰ï¼Œè¿™æ—¶åä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå°±ä¼šç­‰å¾…è¯¥<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œæ‰ä¼šè¢«è°ƒç”¨ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">getJSON</span>(<span class="hljs-string">&quot;/post/1.json&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">post</span>) &#123;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">getJSON</span>(post.<span class="hljs-property">commentURL</span>);
&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">comments</span>) &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;resolved: &quot;</span>, comments);
&#125;, <span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>)&#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;rejected: &quot;</span>, err);
&#125;);</code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬ä¸€ä¸ª<code>then</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œè¿”å›çš„æ˜¯å¦ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚è¿™æ—¶ï¼Œç¬¬äºŒä¸ª<code>then</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå°±ä¼šç­‰å¾…è¿™ä¸ªæ–°çš„<code>Promise</code>å¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–ã€‚å¦‚æœå˜ä¸º<code>resolved</code>ï¼Œå°±è°ƒç”¨ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¦‚æœçŠ¶æ€å˜ä¸º<code>rejected</code>ï¼Œå°±è°ƒç”¨ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ã€‚</p>
<p>å¦‚æœé‡‡ç”¨ç®­å¤´å‡½æ•°ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥å†™å¾—æ›´ç®€æ´ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">getJSON</span>(<span class="hljs-string">&quot;/post/1.json&quot;</span>).<span class="hljs-title function_">then</span>(
  <span class="hljs-function"><span class="hljs-params">post</span> =&gt;</span> <span class="hljs-title function_">getJSON</span>(post.<span class="hljs-property">commentURL</span>)
).<span class="hljs-title function_">then</span>(
  <span class="hljs-function"><span class="hljs-params">comments</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;resolved: &quot;</span>, comments),
  <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;rejected: &quot;</span>, err)
);</code></pre></div>

<p>å‰é¢ä»‹ç»äº† <code>then</code> æ–¹æ³•çš„å‚æ•°å’Œé“¾å¼è°ƒç”¨ï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ <code>then</code> æ–¹æ³•çš„è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯ <code>then</code> æ–¹æ³•ä¸­çš„ <code>return</code>ã€‚</p>
<p>å½“ä¸€ä¸ª <code>Promise</code> å®Œæˆï¼ˆfulfilledï¼‰æˆ–è€…å¤±è´¥ï¼ˆrejectedï¼‰æ—¶ï¼Œè¿”å›å‡½æ•°å°†è¢«å¼‚æ­¥è°ƒç”¨ï¼ˆç”±å½“å‰çš„çº¿ç¨‹å¾ªç¯æ¥è°ƒåº¦å®Œæˆï¼‰ã€‚å…·ä½“çš„è¿”å›å€¼ <code>return</code> ä¾æ®ä»¥ä¸‹è§„åˆ™è¿”å›ã€‚å¦‚æœ <code>then</code> ä¸­çš„å›è°ƒå‡½æ•°ï¼š</p>
<ul>
<li>è¿”å› <code>(return)</code> äº†ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆ <code>then</code> è¿”å›çš„ Promise å°†ä¼šæˆä¸ºæ¥å—çŠ¶æ€ï¼Œå¹¶ä¸”å°†è¿”å›çš„å€¼ä½œä¸ºæ¥å—çŠ¶æ€çš„å›è°ƒå‡½æ•°çš„å‚æ•°å€¼ã€‚</li>
<li>æ²¡æœ‰è¿”å› <code>(return)</code> ä»»ä½•å€¼ï¼Œé‚£ä¹ˆ <code>then</code> è¿”å›çš„ Promise å°†ä¼šæˆä¸ºæ¥å—çŠ¶æ€ï¼Œå¹¶ä¸”è¯¥æ¥å—çŠ¶æ€çš„å›è°ƒå‡½æ•°çš„å‚æ•°å€¼ä¸º <code>undefined</code>ã€‚</li>
<li>æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆ <code>then</code> è¿”å›çš„ Promise å°†ä¼šæˆä¸ºæ‹’ç»çŠ¶æ€ï¼Œå¹¶ä¸”å°†æŠ›å‡ºçš„é”™è¯¯ä½œä¸ºæ‹’ç»çŠ¶æ€çš„å›è°ƒå‡½æ•°çš„å‚æ•°å€¼ã€‚</li>
<li>è¿”å› <code>(return)</code> ä¸€ä¸ªå·²ç»æ˜¯æ¥å—çŠ¶æ€çš„ Promiseï¼Œé‚£ä¹ˆ <code>then</code> è¿”å›çš„ Promise ä¹Ÿä¼šæˆä¸ºæ¥å—çŠ¶æ€ï¼Œå¹¶ä¸”å°†é‚£ä¸ª Promise çš„æ¥å—çŠ¶æ€çš„å›è°ƒå‡½æ•°çš„å‚æ•°å€¼ä½œä¸ºè¯¥è¢«è¿”å›çš„Promiseçš„æ¥å—çŠ¶æ€å›è°ƒå‡½æ•°çš„å‚æ•°å€¼ã€‚</li>
<li>è¿”å› <code>(return)</code> ä¸€ä¸ªå·²ç»æ˜¯æ‹’ç»çŠ¶æ€çš„ Promiseï¼Œé‚£ä¹ˆ <code>then</code> è¿”å›çš„ Promise ä¹Ÿä¼šæˆä¸ºæ‹’ç»çŠ¶æ€ï¼Œå¹¶ä¸”å°†é‚£ä¸ª Promise çš„æ‹’ç»çŠ¶æ€çš„å›è°ƒå‡½æ•°çš„å‚æ•°å€¼ä½œä¸ºè¯¥è¢«è¿”å›çš„Promiseçš„æ‹’ç»çŠ¶æ€å›è°ƒå‡½æ•°çš„å‚æ•°å€¼ã€‚</li>
<li>è¿”å› <code>(return)</code> ä¸€ä¸ªæœªå®šçŠ¶æ€ï¼ˆ<code>pending</code>ï¼‰çš„ Promiseï¼Œé‚£ä¹ˆ <code>then</code> è¿”å› Promise çš„çŠ¶æ€ä¹Ÿæ˜¯æœªå®šçš„ï¼Œå¹¶ä¸”å®ƒçš„ç»ˆæ€ä¸é‚£ä¸ª Promise çš„ç»ˆæ€ç›¸åŒï¼›åŒæ—¶ï¼Œå®ƒå˜ä¸ºç»ˆæ€æ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°å‚æ•°ä¸é‚£ä¸ª Promise å˜ä¸ºç»ˆæ€æ—¶çš„å›è°ƒå‡½æ•°çš„å‚æ•°æ˜¯ç›¸åŒçš„ã€‚</li>
</ul>
<h1 id="é“¾å¼è°ƒç”¨-promise-then"><a href="#é“¾å¼è°ƒç”¨-promise-then" class="headerlink" title="é“¾å¼è°ƒç”¨ promise.then()"></a>é“¾å¼è°ƒç”¨ promise.then()</h1><p><strong><code>then</code> æ–¹æ³•è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå…¶å…è®¸æ–¹æ³•é“¾ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ª promise é“¾ã€‚</strong></p>
<p>é“¾å¼ promise çš„ä¸€ä¸ªå¾ˆå¥½çš„ç¤ºä¾‹æ˜¯ Fetch APIï¼Œå¯ä»¥ç”¨äºè·å–èµ„æºï¼Œä¸”å½“èµ„æºè¢«è·å–æ—¶å°† promise é“¾å¼æ’é˜Ÿè¿›è¡Œæ‰§è¡Œã€‚</p>
<p>Fetch API æ˜¯åŸºäº promise çš„æœºåˆ¶ï¼Œè°ƒç”¨ <code>fetch()</code> ç›¸å½“äºä½¿ç”¨ new Promise() æ¥å®šä¹‰ promsieã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">status</span> = response =&gt; &#123;
  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; response.<span class="hljs-property">status</span> &lt; <span class="hljs-number">300</span>) &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(response)
  &#125;
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(response.<span class="hljs-property">statusText</span>))
&#125;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">json</span> = response =&gt; response.<span class="hljs-title function_">json</span>()

<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/todos.json&#x27;</span>)
  .<span class="hljs-title function_">then</span>(status)    <span class="hljs-comment">// æ³¨æ„ï¼Œ`status` å‡½æ•°å®é™…ä¸Šåœ¨è¿™é‡Œè¢«è°ƒç”¨ï¼Œå¹¶ä¸”åŒæ ·è¿”å› promiseï¼Œ</span>
  .<span class="hljs-title function_">then</span>(json)      <span class="hljs-comment">// è¿™é‡Œå”¯ä¸€çš„åŒºåˆ«æ˜¯çš„ `json` å‡½æ•°ä¼šè¿”å›è§£å†³æ—¶ä¼ å…¥ `data` çš„ promiseï¼Œ</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;  <span class="hljs-comment">// è¿™æ˜¯ `data` ä¼šåœ¨æ­¤å¤„ä½œä¸ºåŒ¿åå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„åŸå› ã€‚</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è¯·æ±‚æˆåŠŸè·å¾— JSON å“åº”&#x27;</span>, data)
  &#125;)
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è¯·æ±‚å¤±è´¥&#x27;</span>, error)
  &#125;)</code></pre></div>

<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œè°ƒç”¨ <code>fetch()</code> ä»åŸŸæ ¹ç›®å½•ä¸­çš„ <code>todos.json</code> æ–‡ä»¶ä¸­è·å– TODO é¡¹ç›®çš„åˆ—è¡¨ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª promise é“¾ã€‚</p>
<p>è¿è¡Œ <code>fetch()</code> ä¼šè¿”å›ä¸€ä¸ªå“åº” <code>response</code>ï¼Œè¯¥å“åº”å…·æœ‰è®¸å¤šå±æ€§ï¼Œåœ¨å±æ€§ä¸­å¼•ç”¨äº†ï¼š</p>
<ul>
<li><code>status</code>ï¼Œè¡¨ç¤º HTTP çŠ¶æ€ç çš„æ•°å€¼ã€‚</li>
<li><code>statusText</code>ï¼ŒçŠ¶æ€æ¶ˆæ¯ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸï¼Œåˆ™ä¸º OKã€‚</li>
</ul>
<p><code>response</code> è¿˜æœ‰ä¸€ä¸ª <code>json()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª promiseï¼Œè¯¥ promise è§£å†³æ—¶ä¼šä¼ å…¥å·²å¤„ç†å¹¶è½¬æ¢ä¸º JSON çš„å“åº”ä½“çš„å†…å®¹ã€‚</p>
<p>å› æ­¤ï¼Œè€ƒè™‘åˆ°è¿™äº›å‰æï¼Œå‘ç”Ÿçš„è¿‡ç¨‹æ˜¯ï¼šé“¾ä¸­çš„ç¬¬ä¸€ä¸ª promise æ˜¯æˆ‘ä»¬å®šä¹‰çš„å‡½æ•°ï¼Œå³ <code>status()</code>ï¼Œå®ƒä¼šæ£€æŸ¥å“åº”çš„çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯æˆåŠŸå“åº”ï¼ˆä»‹äº 200 å’Œ 299 ä¹‹é—´ï¼‰ï¼Œåˆ™å®ƒä¼šæ‹’ç» promiseã€‚</p>
<p>æ­¤æ“ä½œä¼šå¯¼è‡´ promise é“¾è·³è¿‡åˆ—å‡ºçš„æ‰€æœ‰è¢«é“¾çš„ promiseï¼Œä¸”ä¼šç›´æ¥è·³åˆ°åº•éƒ¨çš„ <code>catch()</code> è¯­å¥ï¼ˆè®°å½•<code>è¯·æ±‚å¤±è´¥</code>çš„æ–‡æœ¬å’Œé”™è¯¯æ¶ˆæ¯ï¼‰ã€‚</p>
<p>å¦‚æœæˆåŠŸï¼Œåˆ™ä¼šè°ƒç”¨å®šä¹‰çš„ <code>json()</code> å‡½æ•°ã€‚ ç”±äºä¸Šä¸€ä¸ª promise æˆåŠŸåè¿”å›äº† response å¯¹è±¡ï¼Œå› æ­¤å°†å…¶ä½œä¸ºç¬¬äºŒä¸ª promise çš„è¾“å…¥ã€‚</p>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œè¿”å›å¤„ç†åçš„ JSON æ•°æ®ï¼Œå› æ­¤ç¬¬ä¸‰ä¸ª promise ç›´æ¥æ¥æ”¶ JSONï¼š</p>
<div class="code-wrapper"><pre><code class="hljs javascript">.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è¯·æ±‚æˆåŠŸè·å¾— JSON å“åº”&#x27;</span>, data)
&#125;)</code></pre></div>

<h1 id="Promise-prototype-catch"><a href="#Promise-prototype-catch" class="headerlink" title="Promise.prototype.catch()"></a>Promise.prototype.catch()</h1><p><code>catch()</code> æ–¹æ³•è¿”å›ä¸€ä¸ª<code>Promise</code>ï¼Œå¹¶ä¸”å¤„ç†æ‹’ç»çš„æƒ…å†µã€‚å®ƒçš„è¡Œä¸ºä¸è°ƒç”¨<code>Promise.prototype.then(undefined, onRejected)</code> ç›¸åŒã€‚</p>
<p>äº‹å®ä¸Š, calling <code>obj.catch(onRejected)</code> å†…éƒ¨calls <code>obj.then(undefined, onRejected)</code>ã€‚(è¿™å¥è¯çš„æ„æ€æ˜¯ï¼Œæˆ‘ä»¬æ˜¾å¼ä½¿ç”¨<code>obj.catch(onRejected)</code>ï¼Œå†…éƒ¨å®é™…è°ƒç”¨çš„æ˜¯<code>obj.then(undefined, onRejected)</code>)</p>
<p><code>Promise.prototype.catch()</code>æ–¹æ³•æ˜¯<code>.then(null, rejection)</code>æˆ–<code>.then(undefined, rejection)</code>çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">getJSON</span>(<span class="hljs-string">&#x27;/posts.json&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">posts</span>) &#123;
  <span class="hljs-comment">// ...</span>
&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) &#123;
  <span class="hljs-comment">// å¤„ç† getJSON å’Œ å‰ä¸€ä¸ªå›è°ƒå‡½æ•°è¿è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;å‘ç”Ÿé”™è¯¯ï¼&#x27;</span>, error);
&#125;);</code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>getJSON()</code>æ–¹æ³•è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¦‚æœè¯¥å¯¹è±¡çŠ¶æ€å˜ä¸º<code>resolved</code>ï¼Œåˆ™ä¼šè°ƒç”¨<code>then()</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼›å¦‚æœå¼‚æ­¥æ“ä½œæŠ›å‡ºé”™è¯¯ï¼ŒçŠ¶æ€å°±ä¼šå˜ä¸º<code>rejected</code>ï¼Œå°±ä¼šè°ƒç”¨<code>catch()</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå¤„ç†è¿™ä¸ªé”™è¯¯ã€‚å¦å¤–ï¼Œ<code>then()</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœè¿è¡Œä¸­æŠ›å‡ºé”™è¯¯ï¼Œä¹Ÿä¼šè¢«<code>catch()</code>æ–¹æ³•æ•è·ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript">p.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;fulfilled:&#x27;</span>, val))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;rejected&#x27;</span>, err));
  
<span class="hljs-comment">// ç­‰åŒäº</span>
p.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;fulfilled:&#x27;</span>, val))
  .<span class="hljs-title function_">then</span>(<span class="hljs-literal">null</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;rejected:&quot;</span>, err));</code></pre></div>

<p>â—¾ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) &#123;
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;test&#x27;</span>);
&#125;);
promise.<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);
&#125;);
<span class="hljs-comment">// Error: test</span></code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒpromiseæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå°±è¢«<code>catch()</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°æ•è·ã€‚æ³¨æ„ï¼Œä¸Šé¢çš„å†™æ³•ä¸ä¸‹é¢ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// å†™æ³•ä¸€</span>
<span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) &#123;
  <span class="hljs-keyword">try</span> &#123;
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;test&#x27;</span>);
  &#125; <span class="hljs-keyword">catch</span>(e) &#123;
    <span class="hljs-title function_">reject</span>(e);
  &#125;
&#125;);
promise.<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);
&#125;);
<span class="hljs-comment">// å†™æ³•äºŒ</span>
<span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) &#123;
  <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;test&#x27;</span>));
&#125;);
promise.<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);
&#125;);</code></pre></div>

<p>æ¯”è¾ƒä¸Šé¢ä¸¤ç§å†™æ³•ï¼Œå¯ä»¥å‘ç°reject()æ–¹æ³•çš„ä½œç”¨ï¼Œç­‰åŒäºæŠ›å‡ºé”™è¯¯ã€‚</p>
<p>â—¾ å¦‚æœ Promise çŠ¶æ€å·²ç»å˜æˆresolvedï¼Œå†æŠ›å‡ºé”™è¯¯æ˜¯æ— æ•ˆçš„ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) &#123;
  <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;ok&#x27;</span>);
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;test&#x27;</span>);
&#125;);
promise
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value) &#125;)
  .<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error) &#125;);
<span class="hljs-comment">// ok</span></code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒPromise åœ¨resolveè¯­å¥åé¢ï¼Œå†æŠ›å‡ºé”™è¯¯ï¼Œä¸ä¼šè¢«æ•è·ï¼Œç­‰äºæ²¡æœ‰æŠ›å‡ºã€‚å› ä¸º Promise çš„çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œå°±æ°¸ä¹…ä¿æŒè¯¥çŠ¶æ€ï¼Œä¸ä¼šå†å˜äº†ã€‚</p>
<p>â—¾ Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ªcatchè¯­å¥æ•è·ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">getJSON</span>(<span class="hljs-string">&#x27;/post/1.json&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">post</span>) &#123;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">getJSON</span>(post.<span class="hljs-property">commentURL</span>);
&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">comments</span>) &#123;
  <span class="hljs-comment">// some code</span>
&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) &#123;
  <span class="hljs-comment">// å¤„ç†å‰é¢ä¸‰ä¸ªPromiseäº§ç”Ÿçš„é”™è¯¯</span>
&#125;);</code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œä¸€å…±æœ‰ä¸‰ä¸ª Promise å¯¹è±¡ï¼šä¸€ä¸ªç”±<code>getJSON()</code>äº§ç”Ÿï¼Œä¸¤ä¸ªç”±<code>then()</code>äº§ç”Ÿã€‚å®ƒä»¬ä¹‹ä¸­ä»»ä½•ä¸€ä¸ªæŠ›å‡ºçš„é”™è¯¯ï¼Œéƒ½ä¼šè¢«æœ€åä¸€ä¸ª<code>catch()</code>æ•è·ã€‚</p>
<p>â—¾ ä¸€èˆ¬æ¥è¯´ï¼Œä¸è¦åœ¨<code>then()</code>æ–¹æ³•é‡Œé¢å®šä¹‰ Reject çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼ˆå³<code>then</code>çš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼Œæ€»æ˜¯ä½¿ç”¨<code>catch</code>æ–¹æ³•ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// bad</span>
promise
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;
    <span class="hljs-comment">// success</span>
  &#125;, <span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) &#123;
    <span class="hljs-comment">// error</span>
  &#125;);
  
<span class="hljs-comment">// good</span>
promise
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123; <span class="hljs-comment">//cb</span>
    <span class="hljs-comment">// success</span>
  &#125;)
  .<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) &#123;
    <span class="hljs-comment">// error</span>
  &#125;);</code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬äºŒç§å†™æ³•è¦å¥½äºç¬¬ä¸€ç§å†™æ³•ï¼Œç†ç”±æ˜¯ç¬¬äºŒç§å†™æ³•å¯ä»¥æ•è·å‰é¢<code>then</code>æ–¹æ³•æ‰§è¡Œä¸­çš„é”™è¯¯ï¼Œä¹Ÿæ›´æ¥è¿‘åŒæ­¥çš„å†™æ³•ï¼ˆ<code>try/catch</code>ï¼‰ã€‚å› æ­¤ï¼Œå»ºè®®æ€»æ˜¯ä½¿ç”¨<code>catch()</code>æ–¹æ³•ï¼Œè€Œä¸ä½¿ç”¨<code>then()</code>æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p>â—¾ è·Ÿä¼ ç»Ÿçš„<code>try/catch</code>ä»£ç å—ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨<code>catch()</code>æ–¹æ³•æŒ‡å®šé”™è¯¯å¤„ç†çš„å›è°ƒå‡½æ•°ï¼ŒPromise å¯¹è±¡æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šä¼ é€’åˆ°å¤–å±‚ä»£ç ï¼Œå³ä¸ä¼šæœ‰ä»»ä½•ååº”ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> someAsyncThing = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) &#123;
    <span class="hljs-comment">// ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºxæ²¡æœ‰å£°æ˜</span>
    <span class="hljs-title function_">resolve</span>(x + <span class="hljs-number">2</span>);
  &#125;);
&#125;;
<span class="hljs-title function_">someAsyncThing</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;everything is great&#x27;</span>);
&#125;);
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">123</span>) &#125;, <span class="hljs-number">2000</span>);
<span class="hljs-comment">// Uncaught (in promise) ReferenceError: x is not defined</span>
<span class="hljs-comment">// 123</span></code></pre></div>

<p>åœ¨æµè§ˆå™¨ä¸­è¿è¡Œä¸Šé¢è¿™æ®µä»£ç ï¼Œç­‰å¾…ä¸¤ç§’åï¼Œä½ ä¼šçœ‹åˆ°æ§åˆ¶å°æ­£å¸¸æ‰“å°â€123â€ï¼Œå¹¶æ²¡æœ‰å› ä¸º<code>someAsyncThing()</code>æ–¹æ³•é‡Œçš„é”™è¯¯é˜»å¡ä»£ç è¿è¡Œã€‚</p>
<p><img src="https://s1.ax1x.com/2023/03/23/ppwM0Et.png" srcset="/blog/img/loading.gif" lazyload></p>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>someAsyncThing()</code>å‡½æ•°äº§ç”Ÿçš„ Promise å¯¹è±¡ï¼Œå†…éƒ¨æœ‰è¯­æ³•é”™è¯¯ã€‚æµè§ˆå™¨è¿è¡Œåˆ°è¿™ä¸€è¡Œï¼Œä¼šæ‰“å°å‡ºé”™è¯¯æç¤º<code>ReferenceError: x is not defined</code>ï¼Œä½†æ˜¯ä¸ä¼šé€€å‡ºè¿›ç¨‹ã€ç»ˆæ­¢è„šæœ¬æ‰§è¡Œï¼Œ2 ç§’ä¹‹åè¿˜æ˜¯ä¼šè¾“å‡º123ã€‚è¿™å°±æ˜¯è¯´ï¼ŒPromise å†…éƒ¨çš„é”™è¯¯ä¸ä¼šå½±å“åˆ° Promise å¤–éƒ¨çš„ä»£ç ï¼Œé€šä¿—çš„è¯´æ³•å°±æ˜¯â€œPromise ä¼šåƒæ‰é”™è¯¯â€ã€‚</p>
<h1 id="å¤„ç†é”™è¯¯"><a href="#å¤„ç†é”™è¯¯" class="headerlink" title="å¤„ç†é”™è¯¯"></a>å¤„ç†é”™è¯¯</h1><p>åœ¨ä¸Šä¸€ç« èŠ‚çš„ç¤ºä¾‹ä¸­ï¼Œæœ‰ä¸ª <code>catch</code> è¢«é™„åŠ åˆ°äº† promise é“¾ä¸Šã€‚</p>
<p>å½“ promise é“¾ä¸­çš„ä»»ä½•å†…å®¹å¤±è´¥å¹¶å¼•å‘é”™è¯¯æˆ–æ‹’ç» promise æ—¶ï¼Œåˆ™æ§åˆ¶æƒä¼šè½¬åˆ°é“¾ä¸­æœ€è¿‘çš„ <code>catch()</code> è¯­å¥ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;é”™è¯¯&#x27;</span>)
&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err)
&#125;)

<span class="hljs-comment">// æˆ–</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
  <span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;é”™è¯¯&#x27;</span>)
&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err)
&#125;)</code></pre></div>

<h1 id="çº§è”é”™è¯¯"><a href="#çº§è”é”™è¯¯" class="headerlink" title="çº§è”é”™è¯¯"></a>çº§è”é”™è¯¯</h1><p>å¦‚æœåœ¨ <code>catch()</code> å†…éƒ¨å¼•å‘é”™è¯¯ï¼Œåˆ™å¯ä»¥é™„åŠ ç¬¬äºŒä¸ª <code>catch()</code>æ¥å¤„ç†ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;é”™è¯¯&#x27;</span>)
&#125;)
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;é”™è¯¯&#x27;</span>)
  &#125;)
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err)
  &#125;)</code></pre></div>

<h1 id="Promise-prototype-finally"><a href="#Promise-prototype-finally" class="headerlink" title="Promise.prototype.finally()"></a>Promise.prototype.finally()</h1><p><code>finally()</code>æ–¹æ³•ç”¨äºæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚è¯¥æ–¹æ³•æ˜¯ ES2018 å¼•å…¥æ ‡å‡†çš„ã€‚</p>
<p><code>finally()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªPromiseã€‚åœ¨promiseç»“æŸæ—¶ï¼Œæ— è®ºç»“æœæ˜¯<code>fulfilled</code>æˆ–è€…æ˜¯<code>rejected</code>ï¼Œéƒ½ä¼šæ‰§è¡ŒæŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚è¿™ä¸ºåœ¨<code>Promise</code>æ˜¯å¦æˆåŠŸå®Œæˆåéƒ½éœ€è¦æ‰§è¡Œçš„ä»£ç æä¾›äº†ä¸€ç§æ–¹å¼ã€‚</p>
<p>è¿™é¿å…äº†åŒæ ·çš„è¯­å¥éœ€è¦åœ¨<code>then()</code>å’Œ<code>catch()</code>ä¸­å„å†™ä¸€æ¬¡çš„æƒ…å†µã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript">promise
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> &#123;Â·Â·Â·&#125;)
.<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;Â·Â·Â·&#125;)
.<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> &#123;Â·Â·Â·&#125;);</code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œä¸ç®¡<code>promise</code>æœ€åçš„çŠ¶æ€ï¼Œåœ¨æ‰§è¡Œå®Œ<code>then</code>æˆ–<code>catch</code>æŒ‡å®šçš„å›è°ƒå‡½æ•°ä»¥åï¼Œéƒ½ä¼šæ‰§è¡Œ<code>finally</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</p>
<p>å¦‚æœä½ æƒ³åœ¨ <code>promise</code> æ‰§è¡Œå®Œæ¯•åæ— è®ºå…¶ç»“æœæ€æ ·éƒ½åšä¸€äº›å¤„ç†æˆ–æ¸…ç†æ—¶ï¼Œ<code>finally()</code> æ–¹æ³•å¯èƒ½æ˜¯æœ‰ç”¨çš„ã€‚</p>
<p>â—¾ ç”±äºæ— æ³•çŸ¥é“<code>promise</code>çš„æœ€ç»ˆçŠ¶æ€ï¼Œæ‰€ä»¥<code>finally</code>çš„å›è°ƒå‡½æ•°ä¸­ä¸æ¥æ”¶ä»»ä½•å‚æ•°ï¼Œå®ƒä»…ç”¨äºæ— è®ºæœ€ç»ˆç»“æœå¦‚ä½•éƒ½è¦æ‰§è¡Œçš„æƒ…å†µã€‚</p>
<p>â—¾ ä¸<code>Promise.resolve(2).then(() =&gt; &#123;&#125;, () =&gt; &#123;&#125;)</code> ï¼ˆresolvedçš„ç»“æœä¸º<code>undefined</code>ï¼‰ä¸åŒï¼Œ<code>Promise.resolve(2).finally(() =&gt; &#123;&#125;)</code> resolvedçš„ç»“æœä¸º <code>2</code>ã€‚</p>
<p><img src="https://s1.ax1x.com/2023/03/23/ppwMD4f.png" srcset="/blog/img/loading.gif" lazyload></p>
<p>â—¾ åŒæ ·ï¼Œ<code>Promise.reject(3).then(() =&gt; &#123;&#125;, () =&gt; &#123;&#125;)</code> (fulfilledçš„ç»“æœä¸º<code>undefined</code>), <code>Promise.reject(3).finally(() =&gt; &#123;&#125;)</code> rejected çš„ç»“æœä¸º <code>3</code>ã€‚</p>
<p><img src="https://s1.ax1x.com/2023/03/23/ppwM55V.png" srcset="/blog/img/loading.gif" lazyload></p>
<h1 id="å¹¶å‘-promise-all"><a href="#å¹¶å‘-promise-all" class="headerlink" title="å¹¶å‘ promise.all()"></a>å¹¶å‘ promise.all()</h1><p>å¯ä»¥ä½¿ç”¨<code>Promise.all()</code>ï¼Œ<strong>å‘èµ·å¤šä¸ªå¹¶å‘è¯·æ±‚</strong>ï¼Œç„¶ååœ¨æ‰€æœ‰ promise éƒ½è¢«è§£å†³åæ‰§è¡Œä¸€äº›æ“ä½œã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserAccount</span>(<span class="hljs-params"></span>) &#123;
  <span class="hljs-keyword">return</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user/12345&#x27;</span>);
&#125;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserPermissions</span>(<span class="hljs-params"></span>) &#123;
  <span class="hljs-keyword">return</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user/12345/permissions&#x27;</span>);
&#125;

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">getUserAccount</span>(), <span class="hljs-title function_">getUserPermissions</span>()])
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">results</span>) &#123;
    <span class="hljs-keyword">const</span> acct = results[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">const</span> perm = results[<span class="hljs-number">1</span>];
  &#125;);</code></pre></div>

<p>ES2015 è§£æ„èµ‹å€¼è¯­æ³•ä¹Ÿå¯ä»¥æ‰§è¡Œï¼š</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([getUserAccount, getUserPermissions]).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">[res1, res2]</span>) =&gt;</span> &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ç»“æœ&#x27;</span>, res1, res2)
&#125;)</code></pre></div>

<p>å½“ç„¶ï¼Œä¸é™äºä½¿ç”¨ <code>axios</code>ï¼Œä»»ä½• promise éƒ½å¯ä»¥ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼š</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> promise1 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>);
<span class="hljs-keyword">const</span> promise2 = <span class="hljs-number">42</span>;
<span class="hljs-keyword">const</span> promise3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
  <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">100</span>, <span class="hljs-string">&#x27;foo&#x27;</span>);
&#125;);

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([promise1, promise2, promise3]).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">values</span>) =&gt;</span> &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(values);
&#125;);
<span class="hljs-comment">// expected output: Array [3, 42, &quot;foo&quot;]</span></code></pre></div>

<h1 id="ç«é€Ÿ-promise-race"><a href="#ç«é€Ÿ-promise-race" class="headerlink" title="ç«é€Ÿ promise.race()"></a>ç«é€Ÿ promise.race()</h1><p>raceçš„ç”¨æ³•æ˜¯ï¼š<strong>ä¼ å…¥å¤šä¸ªpromiseå®ä¾‹ï¼Œè°è·‘çš„å¿«ï¼Œå°±ä»¥è°çš„ç»“æœæ‰§è¡Œå›è°ƒ</strong></p>
<p><code>Promise.raceèµ›è·‘æœºåˆ¶ï¼Œåªè®¤ç¬¬ä¸€å</code></p>
<p>ä¼ ç»™ <code>race()</code> çš„ <code>promiseåˆ—è¡¨</code>ï¼Œ<strong>åªè¦æœ‰ä¸€ä¸ªpromiseè¢«è§£å†³ï¼Œåˆ™ <code>Promise.race()</code> å¼€å§‹è¿è¡Œï¼Œå¹¶ä¸”åªè¿è¡Œä¸€æ¬¡é™„åŠ çš„å›è°ƒï¼ˆä¼ å…¥ç¬¬ä¸€ä¸ªè¢«è§£å†³çš„ <code>promise</code> çš„ç»“æœï¼‰</strong>ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> first = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
  <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">500</span>, <span class="hljs-string">&#x27;ç¬¬ä¸€ä¸ª&#x27;</span>)
&#125;)
<span class="hljs-keyword">const</span> second = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
  <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">100</span>, <span class="hljs-string">&#x27;ç¬¬äºŒä¸ª&#x27;</span>)
&#125;)

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([first, second]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result) <span class="hljs-comment">// ç¬¬äºŒä¸ª</span>
&#125;)</code></pre></div>

<p><strong>â—¾ ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>1ã€æŠŠå¼‚æ­¥æ“ä½œå’Œå®šæ—¶å™¨æ”¾åˆ°ä¸€èµ·ï¼Œå¦‚æœå®šæ—¶å™¨å…ˆè§¦å‘ï¼Œè®¤ä¸ºè¶…æ—¶ï¼Œå‘ŠçŸ¥ç”¨æˆ·ï¼›</li>
<li>2ã€å¦‚æœå›¾ç‰‡ç­‰èµ„æºæœ‰å¤šä¸ªå­˜æ”¾è·¯å¾„ï¼Œä½†æ˜¯ä¸ç¡®å®šå“ªä¸ªè·¯å¾„çš„èµ„æºæ›´å¿«ï¼Œå¯ä»¥ç”¨è¯¥æ–¹æ³•åŒæ—¶è¯·æ±‚å¤šä¸ªè·¯å¾„ï¼Œå“ªä¸ªè·¯å¾„çš„èµ„æºæœ€å…ˆæ‹¿åˆ°ï¼Œä½¿ç”¨å“ªä¸ªèµ„æº</li>
<li>3ã€å¦‚æœæŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è·å¾—ç»“æœï¼Œå°±å°† Promise çš„çŠ¶æ€å˜ä¸º<code>reject</code>ï¼Œå¦åˆ™å˜ä¸º<code>resolve</code></li>
</ul>
<p>å®ä¾‹ï¼š</p>
<p>â—¾ æŠŠå¼‚æ­¥æ“ä½œå’Œå®šæ—¶å™¨æ”¾åˆ°ä¸€èµ·ï¼Œå¦‚æœå®šæ—¶å™¨å…ˆè§¦å‘ï¼Œè®¤ä¸ºè¶…æ—¶ï¼Œå‘ŠçŸ¥ç”¨æˆ·:</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">timeOut</span>(<span class="hljs-params">time</span>) &#123;
    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>) =&gt;</span> &#123;
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;
            <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;è¯·æ±‚è¶…æ—¶&quot;</span>)
        &#125;, time) <span class="hljs-comment">// ä¸ºäº†éªŒè¯æ–¹æ³•ï¼Œå¯ä»¥æŠŠæ—¶é—´è®¾å°ç‚¹</span>
    &#125;);
    <span class="hljs-keyword">return</span> result;
&#125;

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([<span class="hljs-title function_">timeOut</span>(<span class="hljs-number">200</span>), <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://api.github.com/users/ruanyf&#x27;</span>)]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
&#125;)</code></pre></div>

<p>ç°ä»£æµè§ˆå™¨åŸç”Ÿæ”¯æŒfetchï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œä¸Šé¢çš„ä»£ç ï¼š</p>
<p>ä¸ºäº†æ¼”ç¤ºæ•ˆæœï¼Œè¿™é‡Œ<code>setTimeout</code>æ—¶é—´è®¾å°ä¸€ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å®šæ—¶å™¨å…ˆå®Œæˆï¼Œç„¶å <code>race()</code> æ–¹æ³•ä»¥å®šæ—¶å™¨çš„ç»“æœæ‰§è¡Œäº†å›è°ƒ</p>
<p><img src="https://s1.ax1x.com/2023/03/23/ppwQp8O.png" srcset="/blog/img/loading.gif" lazyload></p>
<p>æŠŠ<code>setTimeout</code>è®¾å¤§ä¸€ç‚¹ï¼Œè¿™æ¬¡æ¥å£å…ˆè¯·æ±‚å®Œæˆï¼Œæ‰€ä»¥ <code>race()</code> ä»¥æ¥å£çš„ç»“æœæ‰§è¡Œäº†å›è°ƒ</p>
<p><img src="https://s1.ax1x.com/2023/03/23/ppwQiKH.png" srcset="/blog/img/loading.gif" lazyload></p>
<p>â—¾ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœæŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è·å¾—ç»“æœï¼Œå°±å°† Promise çš„çŠ¶æ€å˜ä¸º<code>reject</code>ï¼Œå¦åˆ™å˜ä¸º<code>resolve</code>ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> p = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/resource-that-may-take-a-while&#x27;</span>),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) &#123;
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;request timeout&#x27;</span>)), <span class="hljs-number">5000</span>)
  &#125;)
]);

p
.<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>)
.<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);</code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœ 5 ç§’ä¹‹å†…<code>fetch</code>æ–¹æ³•æ— æ³•è¿”å›ç»“æœï¼Œå˜é‡<code>p</code>çš„çŠ¶æ€å°±ä¼šå˜ä¸º<code>rejected</code>ï¼Œä»è€Œè§¦å‘<code>catch</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</p>
<h1 id="Promise-allSettled"><a href="#Promise-allSettled" class="headerlink" title="Promise.allSettled()"></a>Promise.allSettled()</h1><p>è¯¥<code>Promise.allSettled()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªåœ¨æ‰€æœ‰ç»™å®šçš„promiseéƒ½å·²ç»<code>fulfilled</code>æˆ–<code>rejected</code>åçš„promiseï¼Œå¹¶å¸¦æœ‰ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡è¡¨ç¤ºå¯¹åº”çš„promiseç»“æœã€‚</p>
<p>å½“æ‚¨æœ‰å¤šä¸ªå½¼æ­¤ä¸ä¾èµ–çš„å¼‚æ­¥ä»»åŠ¡æˆåŠŸå®Œæˆæ—¶ï¼Œæˆ–è€…æ‚¨æ€»æ˜¯æƒ³çŸ¥é“æ¯ä¸ªpromiseçš„ç»“æœæ—¶ï¼Œé€šå¸¸ä½¿ç”¨å®ƒã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<code>Promise.all()</code> æ›´é€‚åˆå½¼æ­¤ç›¸äº’ä¾èµ–æˆ–è€…åœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ª<code>reject</code>æ—¶ç«‹å³ç»“æŸã€‚</p>
<p><code>Promise.allSettled()</code>æ–¹æ³•æ¥å—ä¸€ç»„ Promise å®ä¾‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚åªæœ‰ç­‰åˆ°æ‰€æœ‰è¿™äº›å‚æ•°å®ä¾‹éƒ½è¿”å›ç»“æœï¼Œä¸ç®¡æ˜¯<code>fulfilled</code>è¿˜æ˜¯<code>rejected</code>ï¼ŒåŒ…è£…å®ä¾‹æ‰ä¼šç»“æŸã€‚è¯¥æ–¹æ³•ç”± ES2020 å¼•å…¥ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> promises = [
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api-1&#x27;</span>),
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api-2&#x27;</span>),
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api-3&#x27;</span>),
];
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(promises);
<span class="hljs-title function_">removeLoadingIndicator</span>();<span class="hljs-comment">// ç§»é™¤åŠ è½½çš„æ»šåŠ¨å›¾æ ‡</span></code></pre></div>

<p>ä¸Šé¢ä»£ç å¯¹æœåŠ¡å™¨å‘å‡ºä¸‰ä¸ªè¯·æ±‚ï¼Œç­‰åˆ°ä¸‰ä¸ªè¯·æ±‚éƒ½ç»“æŸï¼Œä¸ç®¡è¯·æ±‚æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼ŒåŠ è½½çš„æ»šåŠ¨å›¾æ ‡å°±ä¼šæ¶ˆå¤±ã€‚</p>
<p>è¯¥æ–¹æ³•è¿”å›çš„æ–°çš„ Promise å®ä¾‹ï¼Œä¸€æ—¦ç»“æŸï¼ŒçŠ¶æ€æ€»æ˜¯<code>fulfilled</code>ï¼Œä¸ä¼šå˜æˆ<code>rejected</code>ã€‚çŠ¶æ€å˜æˆ<code>fulfilled</code>åï¼ŒPromise çš„ç›‘å¬å‡½æ•°æ¥æ”¶åˆ°çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªæˆå‘˜å¯¹åº”ä¸€ä¸ªä¼ å…¥<code>Promise.allSettled()</code>çš„ Promise å®ä¾‹ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> resolved = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">42</span>);
<span class="hljs-keyword">const</span> rejected = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(-<span class="hljs-number">1</span>);

<span class="hljs-keyword">const</span> allSettledPromise = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>([resolved, rejected]);

allSettledPromise.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">results</span>) &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(results);
&#125;);
<span class="hljs-comment">// [</span>
<span class="hljs-comment">//    &#123; status: &#x27;fulfilled&#x27;, value: 42 &#125;,</span>
<span class="hljs-comment">//    &#123; status: &#x27;rejected&#x27;, reason: -1 &#125;</span>
<span class="hljs-comment">// ]</span></code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>Promise.allSettled()</code>çš„è¿”å›å€¼<code>allSettledPromise</code>ï¼ŒçŠ¶æ€åªå¯èƒ½å˜æˆ<code>fulfilled</code>ã€‚å®ƒçš„ç›‘å¬å‡½æ•°æ¥æ”¶åˆ°çš„å‚æ•°æ˜¯æ•°ç»„<code>results</code>ã€‚è¯¥æ•°ç»„çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹åº”ä¼ å…¥<code>Promise.allSettled()</code>çš„ä¸¤ä¸ª Promise å®ä¾‹ã€‚æ¯ä¸ªå¯¹è±¡éƒ½æœ‰<code>status</code>å±æ€§ï¼Œè¯¥å±æ€§çš„å€¼åªå¯èƒ½æ˜¯å­—ç¬¦ä¸²<code>fulfilled</code>æˆ–å­—ç¬¦ä¸²<code>rejected</code>ã€‚<code>fulfilled</code>æ—¶ï¼Œå¯¹è±¡æœ‰<code>value</code>å±æ€§ï¼Œ<code>rejected</code>æ—¶æœ‰<code>reason</code>å±æ€§ï¼Œå¯¹åº”ä¸¤ç§çŠ¶æ€çš„è¿”å›å€¼ã€‚</p>
<p><img src="https://s1.ax1x.com/2023/03/23/ppwQuRS.png" srcset="/blog/img/loading.gif" lazyload></p>
<p>â—¾ ä¸‹é¢æ˜¯è¿”å›å€¼ç”¨æ³•çš„ä¾‹å­ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> promises = [ <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;index.html&#x27;</span>), <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://does-not-exist/&#x27;</span>) ];
<span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(promises);

<span class="hljs-comment">// è¿‡æ»¤å‡ºæˆåŠŸçš„è¯·æ±‚</span>
<span class="hljs-keyword">const</span> successfulPromises = results.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">status</span> === <span class="hljs-string">&#x27;fulfilled&#x27;</span>);

<span class="hljs-comment">// è¿‡æ»¤å‡ºå¤±è´¥çš„è¯·æ±‚ï¼Œå¹¶è¾“å‡ºåŸå› </span>
<span class="hljs-keyword">const</span> errors = results
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">status</span> === <span class="hljs-string">&#x27;rejected&#x27;</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">reason</span>);</code></pre></div>

<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œåªå…³å¿ƒè¿™äº›æ“ä½œæœ‰æ²¡æœ‰ç»“æŸã€‚è¿™æ—¶ï¼Œ<code>Promise.allSettled()</code>æ–¹æ³•å°±å¾ˆæœ‰ç”¨ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œæƒ³è¦ç¡®ä¿æ‰€æœ‰æ“ä½œéƒ½ç»“æŸï¼Œå°±å¾ˆéº»çƒ¦ã€‚<code>Promise.all()</code>æ–¹æ³•æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> urls = [ <span class="hljs-comment">/* ... */</span> ];
<span class="hljs-keyword">const</span> requests = urls.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-title function_">fetch</span>(x));

<span class="hljs-keyword">try</span> &#123;
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(requests);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æ‰€æœ‰è¯·æ±‚éƒ½æˆåŠŸã€‚&#x27;</span>);
&#125; <span class="hljs-keyword">catch</span> &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è‡³å°‘ä¸€ä¸ªè¯·æ±‚å¤±è´¥ï¼Œå…¶ä»–è¯·æ±‚å¯èƒ½è¿˜æ²¡ç»“æŸã€‚&#x27;</span>);
&#125;</code></pre></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>Promise.all()</code>æ— æ³•ç¡®å®šæ‰€æœ‰è¯·æ±‚éƒ½ç»“æŸã€‚æƒ³è¦è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œå†™èµ·æ¥å¾ˆéº»çƒ¦ï¼Œæœ‰äº†<code>Promise.allSettled()</code>ï¼Œè¿™å°±å¾ˆå®¹æ˜“äº†ã€‚</p>
<h1 id="å¸¸è§çš„é”™è¯¯"><a href="#å¸¸è§çš„é”™è¯¯" class="headerlink" title="å¸¸è§çš„é”™è¯¯"></a>å¸¸è§çš„é”™è¯¯</h1><p><strong>â—¾ <code>Uncaught TypeError: undefined is not a promise</code></strong></p>
<p>å¦‚æœåœ¨æ§åˆ¶å°ä¸­æ”¶åˆ° <code>Uncaught TypeError: undefined is not a promise</code> é”™è¯¯ï¼Œåˆ™è¯·ç¡®ä¿ä½¿ç”¨ <code>new Promise()</code> è€Œä¸æ˜¯ <code>Promise()</code>ã€‚</p>
<p><strong>â—¾ <code>UnhandledPromiseRejectionWarning</code></strong></p>
<p>è¿™æ„å‘³ç€è°ƒç”¨çš„ promise è¢«æ‹’ç»ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨äºå¤„ç†é”™è¯¯çš„ catchã€‚ åœ¨ then ä¹‹åæ·»åŠ  catch åˆ™å¯ä»¥æ­£ç¡®åœ°å¤„ç†ã€‚</p>
<h1 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h1><p><code>promise.all</code>å¯ä»¥å°†å¤šä¸ªpromiseå®ä¾‹åŒ…è£…æˆä¸€ä¸ªæ–°çš„promiseå®ä¾‹ï¼Œå¹¶ä¸”è¿”å›çš„å€¼ä¹Ÿä¸ç›¸åŒï¼ŒæˆåŠŸä½¿ï¼Œpromiseè¿”å›çš„å€¼æ˜¯ä¸€ä¸ªç»“æœæ•°ç»„ï¼Œè€Œå¤±è´¥çš„è¯å°±æ˜¯è¿”å›æœ€å…ˆå“åº”çš„å¤±è´¥çš„å€¼ã€‚</p>
<div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>) =&gt;</span>&#123;    
	<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;æˆåŠŸäº†ï¼&#x27;</span>);
&#125;)
<span class="hljs-keyword">var</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>) =&gt;</span>&#123;    
	<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;æˆåŠŸäº†2ï¼&#x27;</span>);
&#125;)
<span class="hljs-keyword">var</span> p3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>) =&gt;</span>&#123;    
	<span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;å¤±è´¥ï¼&#x27;</span>);
&#125;)
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([p1,p2,p3]).<span class="hljs-property">then</span> (<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span>&#123;    
	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);     <span class="hljs-comment">//å¤±è´¥</span>
&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>)=&gt;</span>&#123;
	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err);
&#125;)
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([p1,p2,p3]).<span class="hljs-property">then</span> (<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span>&#123;    
	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);  <span class="hljs-comment">//æˆåŠŸäº†</span>
&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>)=&gt;</span>&#123;    
	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err);  
&#125;</code></pre></div>

<ul>
<li><code>promise.all</code>åœ¨å¤„ç†å¤šä¸ªå¼‚æ­¥æ•°æ®è¯·æ±‚çš„æ—¶å€™éå¸¸å®ç”¨ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªé¡µé¢éœ€è¦è¯·æ±‚æ¥ä¸¤ä¸ªç”šè‡³æ›´å¤šçš„Ajaxè¯·æ±‚æ•°æ®åæ‰èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œåœ¨æ­¤ä¹‹å‰ä½¿ç”¨loadingå›¾æ ‡æ˜¾ç¤ºã€‚</li>
<li><code>promise.race</code>çš„è¯ï¼Œä»å­—é¢ä¸Šçœ‹çš„è¯å°±æ˜¯è°çš„å“åº”é€Ÿåº¦å¿«çš„è¯å°±è°å…ˆè¿”å›ï¼Œä¸ç®¡æ˜¯æˆåŠŸçš„å›è°ƒè¿˜æ˜¯å¤±è´¥çš„å›è°ƒæ•°æ®ã€‚</li>
</ul>
<blockquote>
<p>ä½¿ç”¨åœºæ™¯ï¼šæŠŠå¼‚æ­¥æ“ä½œå’Œå®šæ—¶å™¨æ”¾åˆ°ä¸€èµ·ï¼Œå¦‚æœå®šæ—¶å™¨å…ˆè§¦å‘ï¼Œè®¤ä¸ºè¶…æ—¶ï¼Œå‘ŠçŸ¥ç”¨æˆ·.</p>
</blockquote>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise - JavaScript | MDN (mozilla.org)</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">JavaScript Promise (nodejs.cn)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bookstack.cn/read/es6-3rd/docs-promise.md">é˜®ä¸€å³° ECMAScript 6 (ES6) æ ‡å‡†å…¥é—¨æ•™ç¨‹ ç¬¬ä¸‰ç‰ˆ</a></li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/blog/categories/javascript/" class="category-chain-item">javascript</a>
  
  
    <span>></span>
    
  <a href="/blog/categories/javascript/es6/" class="category-chain-item">es6</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/blog/tags/promise/">#promise</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/interview-summarize.html" title="é¢è¯•é¢˜æ€»ç»“">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">é¢è¯•é¢˜æ€»ç»“</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/interview-javascript.html" title="é¢è¯•é¢˜æ±‡æ€»ä¹‹React">
                        <span class="hidden-mobile">é¢è¯•é¢˜æ±‡æ€»ä¹‹React</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <span>æ«ğŸå·</span> <i class="iconfont icon-love"></i> <span>å‰ç«¯å°ç™½</span> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  
</div>
<script type="text/javascript" src="/blog/js/click-love.js"></script>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/blog/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/blog/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/blog/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/blog/live2dw/assets/chitose.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>
</html>
